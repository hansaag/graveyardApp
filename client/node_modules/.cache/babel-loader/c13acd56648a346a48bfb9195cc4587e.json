{"ast":null,"code":"var _jsxFileName = \"/home/hans/dev/personlig/graveyardApp/client/src/components/ProjectInfo.js\";\nimport React, { useState, useContext, Fragment, useEffect } from \"react\";\nimport { GlobalContext } from \"../contexts/GlobalContext\";\nimport { ProjectContext } from \"../contexts/ProjectContext\";\nimport { ProgressContext } from \"../contexts/ProgressContext\";\nimport { ProgressBar } from \"./ProgressBar\";\nimport { chosenConnection } from \"../utilities/Connections\";\n\nconst ProjectInfo = ({\n  updateLocalProjectValue,\n  index\n}) => {\n  let newComment;\n  const {\n    value,\n    setValue\n  } = useContext(GlobalContext);\n  const {\n    viewProject,\n    setViewProject\n  } = useContext(ProjectContext);\n  const {\n    temporaryProgress,\n    setTemporaryProgress\n  } = useContext(ProgressContext);\n  const [commentsRendered, setCommentsRendered] = useState([]);\n  const [newlyAddedComment, setNewlyAddedComment] = useState(false);\n  const [input, setInput] = useState(false);\n  const [progressAdded, SetProgressAdded] = useState(false);\n\n  const registerInput = e => {\n    console.log(e.target.value);\n\n    if (e.target.value.length < 4) {\n      setInput(false);\n    } else setInput(true);\n  };\n\n  let id = value.gy.id;\n\n  const renderComments = arr => {\n    let fetchedComments = arr.map(it => {\n      let dateEntry = it[\"added\"].substring(8, 10) + \".\" + it[\"added\"].substring(5, 7);\n      return /*#__PURE__*/React.createElement(\"li\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 35,\n          columnNumber: 9\n        }\n      }, /*#__PURE__*/React.createElement(\"p\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 36,\n          columnNumber: 11\n        }\n      }, \"- \\xA0 \", /*#__PURE__*/React.createElement(\"span\", {\n        className: \"comment-date\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 37,\n          columnNumber: 22\n        }\n      }, dateEntry), \": \\xA0\", it[\"comment\"]));\n    });\n    console.log(fetchedComments);\n    setCommentsRendered(fetchedComments);\n  };\n\n  const getComments = async () => {\n    try {\n      await fetch(`${chosenConnection}/comments/${id}/${viewProject[\"project_id\"]}`).then(res => res.json()).then(json => renderComments(json));\n    } catch (err) {\n      console.error(err.message);\n    }\n  };\n\n  const addComment = async () => {\n    newComment = document.getElementById(\"project-textarea\").value;\n    console.log(newComment.length);\n    console.log(\"this is the value\", value);\n    if (newComment.length < 5) return;\n    let ser = viewProject.project_id;\n\n    try {\n      const body = {\n        id,\n        ser,\n        newComment\n      };\n      console.log(body);\n      await fetch(`${chosenConnection}/comments`, {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(body)\n      });\n      document.getElementById(\"project-textarea\").value = null;\n      setNewlyAddedComment(true);\n      setInput(false);\n    } catch (err) {\n      console.error(err.message);\n    }\n  };\n\n  const increaseProgress = () => {\n    SetProgressAdded(true);\n    setTemporaryProgress(prev => {\n      if (temporaryProgress === null) {\n        console.log(temporaryProgress);\n        console.log(viewProject.percent_finished);\n        return viewProject.percent_finished + 5;\n      } else if (temporaryProgress === 100) {\n        return prev;\n      } else {\n        console.log(temporaryProgress);\n        return prev + 5;\n      }\n    });\n  };\n\n  const regretProgress = () => {\n    setTemporaryProgress(null);\n    SetProgressAdded(false);\n  };\n\n  const submitProgress = async () => {\n    SetProgressAdded(false);\n\n    try {\n      const body = {\n        temporaryProgress\n      };\n      console.log(body);\n      await fetch(`${chosenConnection}/projects/${viewProject.gy_id}/${viewProject.project_id}`, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\"\n        },\n        body: JSON.stringify(body)\n      });\n      updateLocalProjectValue(viewProject, temporaryProgress);\n      setTemporaryProgress(body[\"temporaryProgress\"]);\n    } catch (err) {\n      console.log(err.message);\n    }\n  };\n\n  useEffect(() => {\n    regretProgress();\n    getComments();\n  }, [viewProject]);\n  useEffect(() => {\n    getComments();\n    setNewlyAddedComment(false);\n  }, [newlyAddedComment]);\n\n  if (viewProject) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"project-info-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"project-title-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"project-visual-info\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"project-prio-visual\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 13\n      }\n    }, \"P\", viewProject.project_prio)), /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 147,\n        columnNumber: 11\n      }\n    }, viewProject.project_title)), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"project-start-date\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 11\n      }\n    }, \"Startet: \", viewProject.added.substring(8, 10), \".\", viewProject.added.substring(5, 7), \".\", viewProject.added.substring(0, 4))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"progress-box\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(ProgressBar, {\n      done: viewProject.percent_finished,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 11\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"progress-input\",\n      onClick: increaseProgress,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159,\n        columnNumber: 11\n      }\n    }, \"+\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: `progress-abort-button ${progressAdded ? \"show\" : \"\"}`,\n      onClick: regretProgress,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 11\n      }\n    }, \"x\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: `progress-register-button ${progressAdded ? \"show\" : \"\"}`,\n      onClick: submitProgress,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 168,\n        columnNumber: 11\n      }\n    }, \"\\u2713\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"project-descr-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      className: \"project-description-header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 179,\n        columnNumber: 11\n      }\n    }, \"Tilleggsinformasjon\"), /*#__PURE__*/React.createElement(\"p\", {\n      className: \"project-description\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 11\n      }\n    }, viewProject.project_descr)), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"project-completion-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 182,\n        columnNumber: 9\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"comment-list-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      className: \"comment-list-header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 11\n      }\n    }, \"Kommentarer\"), /*#__PURE__*/React.createElement(\"ul\", {\n      className: \"comment-list\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 11\n      }\n    }, commentsRendered), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"comment-input-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 186,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"textarea\", {\n      className: \"comment-textarea\",\n      id: \"project-textarea\",\n      placeholder: \" Skriv en kommentar \\r (minst 4 tegn)\",\n      onChange: e => registerInput(e),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"div\", {\n      className: `add-comment-button ${input ? \"show\" : \"\"}`,\n      id: \"submit-comment\",\n      onClick: addComment,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 13\n      }\n    }, \"+\"))));\n  } else return null;\n};\n\nexport default ProjectInfo;","map":{"version":3,"sources":["/home/hans/dev/personlig/graveyardApp/client/src/components/ProjectInfo.js"],"names":["React","useState","useContext","Fragment","useEffect","GlobalContext","ProjectContext","ProgressContext","ProgressBar","chosenConnection","ProjectInfo","updateLocalProjectValue","index","newComment","value","setValue","viewProject","setViewProject","temporaryProgress","setTemporaryProgress","commentsRendered","setCommentsRendered","newlyAddedComment","setNewlyAddedComment","input","setInput","progressAdded","SetProgressAdded","registerInput","e","console","log","target","length","id","gy","renderComments","arr","fetchedComments","map","it","dateEntry","substring","getComments","fetch","then","res","json","err","error","message","addComment","document","getElementById","ser","project_id","body","method","headers","JSON","stringify","increaseProgress","prev","percent_finished","regretProgress","submitProgress","gy_id","project_prio","project_title","added","project_descr"],"mappings":"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","sourcesContent":["import React, { useState, useContext, Fragment, useEffect } from \"react\";\n\nimport { GlobalContext } from \"../contexts/GlobalContext\";\nimport { ProjectContext } from \"../contexts/ProjectContext\";\nimport { ProgressContext } from \"../contexts/ProgressContext\";\nimport { ProgressBar } from \"./ProgressBar\";\nimport { chosenConnection } from \"../utilities/Connections\";\n\nconst ProjectInfo = ({ updateLocalProjectValue, index }) => {\n  let newComment;\n  const { value, setValue } = useContext(GlobalContext);\n  const { viewProject, setViewProject } = useContext(ProjectContext);\n  const { temporaryProgress, setTemporaryProgress } = useContext(\n    ProgressContext\n  );\n  const [commentsRendered, setCommentsRendered] = useState([]);\n  const [newlyAddedComment, setNewlyAddedComment] = useState(false);\n  const [input, setInput] = useState(false);\n  const [progressAdded, SetProgressAdded] = useState(false);\n\n  const registerInput = (e) => {\n    console.log(e.target.value);\n    if (e.target.value.length < 4) {\n      setInput(false);\n    } else setInput(true);\n  };\n  \n  let id = value.gy.id;\n\n  const renderComments = (arr) => {\n    let fetchedComments = arr.map((it) => {\n      let dateEntry =\n        it[\"added\"].substring(8, 10) + \".\" + it[\"added\"].substring(5, 7);\n      return (\n        <li>\n          <p>\n            - &nbsp; <span className=\"comment-date\">{dateEntry}</span>: &nbsp;\n            {it[\"comment\"]}\n          </p>\n        </li>\n      );\n    });\n    console.log(fetchedComments);\n    setCommentsRendered(fetchedComments);\n  };\n  const getComments = async () => {\n    try {\n      await fetch(\n        `${chosenConnection}/comments/${id}/${viewProject[\"project_id\"]}`\n      )\n        .then((res) => res.json())\n        .then((json) => renderComments(json));\n    } catch (err) {\n      console.error(err.message);\n    }\n  };\n\n  const addComment = async () => {\n    newComment = document.getElementById(\"project-textarea\").value;\n    console.log(newComment.length);\n    console.log(\"this is the value\", value);\n    if (newComment.length < 5) return;\n    let ser = viewProject.project_id;\n    try {\n      const body = {\n        id,\n        ser,\n        newComment,\n      };\n      console.log(body);\n      await fetch(`${chosenConnection}/comments`, {\n        method: \"POST\",\n        headers: { \"Content-Type\": \"application/json\" },\n        body: JSON.stringify(body),\n      });\n      document.getElementById(\"project-textarea\").value = null;\n      setNewlyAddedComment(true);\n      setInput(false);\n    } catch (err) {\n      console.error(err.message);\n    }\n  };\n\n  const increaseProgress = () => {\n    SetProgressAdded(true);\n\n    setTemporaryProgress((prev) => {\n      if (temporaryProgress === null) {\n        console.log(temporaryProgress);\n        console.log(viewProject.percent_finished);\n        return viewProject.percent_finished + 5;\n      } else if (temporaryProgress === 100) {\n        return prev;\n      } else {\n        console.log(temporaryProgress);\n\n        return prev + 5;\n      }\n    });\n  };\n\n  const regretProgress = () => {\n    setTemporaryProgress(null);\n    SetProgressAdded(false);\n  };\n\n  const submitProgress = async () => {\n    SetProgressAdded(false);\n    try {\n      const body = { temporaryProgress };\n      console.log(body);\n      await fetch(\n        `${chosenConnection}/projects/${viewProject.gy_id}/${viewProject.project_id}`,\n        {\n          method: \"PUT\",\n          headers: { \"Content-Type\": \"application/json\" },\n          body: JSON.stringify(body),\n        }\n      );\n\n      updateLocalProjectValue(viewProject, temporaryProgress);\n      setTemporaryProgress(body[\"temporaryProgress\"]);\n    } catch (err) {\n      console.log(err.message);\n    }\n  };\n\n  useEffect(() => {\n    regretProgress();\n    getComments();\n  }, [viewProject]);\n\n  useEffect(() => {\n    getComments();\n    setNewlyAddedComment(false);\n  }, [newlyAddedComment]);\n\n  if (viewProject) {\n    return (\n      <div className=\"project-info-container\">\n        <div className=\"project-title-container\">\n          <div className=\"project-visual-info\">\n            <div className=\"project-prio-visual\">\n              P{viewProject.project_prio}\n            </div>\n          </div>\n          <p>{viewProject.project_title}</p>\n        </div>\n        <div className=\"project-start-date\">\n          <p>\n            Startet: {viewProject.added.substring(8, 10)}.\n            {viewProject.added.substring(5, 7)}.\n            {viewProject.added.substring(0, 4)}\n          </p>\n        </div>\n\n        <div className=\"progress-box\">\n          <ProgressBar done={viewProject.percent_finished} />\n          <div className=\"progress-input\" onClick={increaseProgress}>\n            +\n          </div>\n          <div\n            className={`progress-abort-button ${progressAdded ? \"show\" : \"\"}`}\n            onClick={regretProgress}\n          >\n            x\n          </div>\n          <div\n            className={`progress-register-button ${\n              progressAdded ? \"show\" : \"\"\n            }`}\n            onClick={submitProgress}\n          >\n            &#10003;\n          </div>\n        </div>\n\n        <div className=\"project-descr-container\">\n          <p className=\"project-description-header\">Tilleggsinformasjon</p>\n          <p className=\"project-description\">{viewProject.project_descr}</p>\n        </div>\n        <div className=\"project-completion-container\"></div>\n        <div className=\"comment-list-container\">\n          <p className=\"comment-list-header\">Kommentarer</p>\n          <ul className=\"comment-list\">{commentsRendered}</ul>\n          <div className=\"comment-input-container\">\n            <textarea\n              className=\"comment-textarea\"\n              id=\"project-textarea\"\n              placeholder=\" Skriv en kommentar &#13;&#10;  (minst 4 tegn)\"\n              onChange={(e) => registerInput(e)}\n            ></textarea>\n            <div\n              className={`add-comment-button ${input ? \"show\" : \"\"}`}\n              id=\"submit-comment\"\n              onClick={addComment}\n            >\n              +\n            </div>\n          </div>\n        </div>\n      </div>\n    );\n  } else return null;\n};\n\nexport default ProjectInfo;\n"]},"metadata":{},"sourceType":"module"}