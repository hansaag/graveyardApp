{"ast":null,"code":"var _jsxFileName = \"/home/hans/dev/personlig/graveyardApp/client/src/components/WorkWindow.js\";\nimport React, { useState, useContext, Fragment, useEffect, useMemo, useCallback } from \"react\";\nimport { GlobalContext } from \"../contexts/GlobalContext\";\nimport { GlobalEdit } from \"../contexts/GlobalEdit\";\nimport { FieldButtons } from \"../contexts/FieldButtons\";\nimport { FieldButton } from \"./FieldButton\";\nimport { AllFieldsButton } from \"./AllFieldsButton\";\nimport { returnDates } from \"../utilities/JsonActivities\";\nimport rightArrow from \"../images/right-arrow.png\";\nimport leftArrow from \"../images/left-arrow.png\";\nimport { chosenConnection } from \"../utilities/Connections\";\n/* this component lets the user register which fields and which\ndate an activity has been completed on */\n\nconst WorkWindow = React.memo(({\n  exit,\n  dia,\n  activity\n}) => {\n  const {\n    value,\n    setValue\n  } = useContext(GlobalContext);\n  const {\n    edit,\n    setEdit\n  } = useContext(GlobalEdit);\n  const {\n    allClicked,\n    setAllClicked\n  } = useContext(FieldButtons);\n  const fieldCount = value.gy.fields.length;\n  const allFields = {\n    id: 100,\n    value: \"ALLE\"\n  };\n  const clickedButtons = Array(fieldCount);\n  const handleOnClick = useCallback(id => {\n    console.log(id);\n    clickedButtons[id] = !clickedButtons[id];\n    console.log(clickedButtons);\n  });\n  const currentFields = value.gy.fields.map((item, index) => /*#__PURE__*/React.createElement(\"li\", {\n    className: \"field-list-item\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 43,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(FieldButton, {\n    parentClick: () => handleOnClick(index),\n    index: index,\n    item: item,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 44,\n      columnNumber: 7\n    }\n  })));\n  const allFieldsButton = /*#__PURE__*/React.createElement(AllFieldsButton, {\n    name: allFields.value,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 53,\n      columnNumber: 5\n    }\n  });\n  currentFields.push(allFieldsButton);\n  const refArray = Array(30);\n  let currentRef = 0;\n\n  const handleRightClick = () => {\n    if (currentRef > 0 && refArray[currentRef - 1] !== null) {\n      refArray[currentRef - 1].current.scrollIntoView({\n        behavior: \"smooth\",\n        block: \"start\"\n      });\n      currentRef--;\n      console.log(currentRef);\n    }\n  };\n\n  const handleLeftClick = () => {\n    if (currentRef < 28 && refArray[currentRef + 1] !== null) {\n      refArray[currentRef + 1].current.scrollIntoView({\n        behavior: \"smooth\",\n        block: \"start\"\n      });\n      currentRef++;\n      console.log(currentRef);\n    }\n  };\n\n  const dateArray = returnDates().map((date, index) => {\n    const ref = React.createRef();\n    refArray[index] = ref;\n    const key = index;\n    return /*#__PURE__*/React.createElement(\"li\", {\n      className: \"date-list-item\",\n      ref: ref,\n      dbdate: date.dbValue,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 7\n      }\n    }, date.display);\n  });\n\n  const registerWork = e => {\n    e.preventDefault();\n    let updateArray = Array();\n\n    if (allClicked == 2) {\n      clickedButtons.fill(true);\n    }\n\n    for (let i = 0; i < value.gy.fields.length; i++) {\n      if (clickedButtons[i] == true) updateArray.push(value.gy.fields[i]);\n    }\n\n    const completedDate = dateArray[currentRef].props.dbdate;\n    const dbActivity = activity.dbValue;\n    console.log(completedDate); //should do it all in one call\n\n    if (activity.tag == \"field\") {\n      for (let u in updateArray) {\n        try {\n          const body = {\n            dbActivity,\n            completedDate\n          };\n          const response = fetch(`${chosenConnection}/fields/${value.gy.id}/${updateArray[u]}`, {\n            method: \"PUT\",\n            headers: {\n              \"Content-Type\": \"application/json\"\n            },\n            body: JSON.stringify(body)\n          });\n          console.log(body);\n        } catch (err) {\n          console.log(err.message);\n        }\n      }\n    } else {\n      try {\n        const body = {\n          dbActivity,\n          completedDate\n        };\n        const response = fetch(`${chosenConnection}/graveyards/${value.gy.id}`, {\n          method: \"PUT\",\n          headers: {\n            \"Content-Type\": \"application/json\"\n          },\n          body: JSON.stringify(body)\n        });\n        console.log(body);\n      } catch (err) {\n        console.log(err.message);\n      }\n    }\n\n    exit();\n  };\n\n  useEffect(() => {}, [dia]);\n\n  if (dia) {\n    return /*#__PURE__*/React.createElement(\"div\", {\n      className: \"work-window\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 149,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"work-window-img-and-fields\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 150,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"work-window-header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"p\", {\n      className: \"work-window-text\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 13\n      }\n    }, \"Velg felter der det har blitt \", activity.value.toLowerCase(), \" \"), /*#__PURE__*/React.createElement(\"img\", {\n      src: activity.img,\n      className: \"work-window-img\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 155,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"work-window-img-holder\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: value.gy.img,\n      className: \"work-window-gy\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 158,\n        columnNumber: 13\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"work-window-field-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 160,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"ul\", {\n      className: \"work-window-field-list\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161,\n        columnNumber: 13\n      }\n    }, currentFields))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"date-selection-box\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 165,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"date-selection-header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 166,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"h2\", {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 13\n      }\n    }, \"Velg utf\\xF8rt dato\")), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"date-finished-container\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 169,\n        columnNumber: 11\n      }\n    }, /*#__PURE__*/React.createElement(\"img\", {\n      src: leftArrow,\n      onClick: handleLeftClick,\n      className: \"left-arrow\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 13\n      }\n    }), /*#__PURE__*/React.createElement(\"ul\", {\n      className: \"date-list\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 176,\n        columnNumber: 13\n      }\n    }, dateArray), /*#__PURE__*/React.createElement(\"img\", {\n      src: rightArrow,\n      onClick: handleRightClick,\n      className: \"right-arrow\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 13\n      }\n    }))), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"work-window-footer\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 184,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(\"div\", {\n      className: \"work-window-cancel\",\n      onClick: exit,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185,\n        columnNumber: 11\n      }\n    }, \"Avbryt\"), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"work-window-register\",\n      onClick: registerWork,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 11\n      }\n    }, \"Registrer\")));\n  }\n});\nexport default WorkWindow;","map":{"version":3,"sources":["/home/hans/dev/personlig/graveyardApp/client/src/components/WorkWindow.js"],"names":["React","useState","useContext","Fragment","useEffect","useMemo","useCallback","GlobalContext","GlobalEdit","FieldButtons","FieldButton","AllFieldsButton","returnDates","rightArrow","leftArrow","chosenConnection","WorkWindow","memo","exit","dia","activity","value","setValue","edit","setEdit","allClicked","setAllClicked","fieldCount","gy","fields","length","allFields","id","clickedButtons","Array","handleOnClick","console","log","currentFields","map","item","index","allFieldsButton","push","refArray","currentRef","handleRightClick","current","scrollIntoView","behavior","block","handleLeftClick","dateArray","date","ref","createRef","key","dbValue","display","registerWork","e","preventDefault","updateArray","fill","i","completedDate","props","dbdate","dbActivity","tag","u","body","response","fetch","method","headers","JSON","stringify","err","message","toLowerCase","img"],"mappings":"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","sourcesContent":["import React, {\n  useState,\n  useContext,\n  Fragment,\n  useEffect,\n  useMemo,\n  useCallback,\n} from \"react\";\n\nimport { GlobalContext } from \"../contexts/GlobalContext\";\nimport { GlobalEdit } from \"../contexts/GlobalEdit\";\nimport { FieldButtons } from \"../contexts/FieldButtons\";\nimport { FieldButton } from \"./FieldButton\";\nimport { AllFieldsButton } from \"./AllFieldsButton\";\nimport { returnDates } from \"../utilities/JsonActivities\";\n\nimport rightArrow from \"../images/right-arrow.png\";\nimport leftArrow from \"../images/left-arrow.png\";\nimport { chosenConnection } from \"../utilities/Connections\";\n\n/* this component lets the user register which fields and which\ndate an activity has been completed on */\n\nconst WorkWindow = React.memo(({ exit, dia, activity }) => {\n  const { value, setValue } = useContext(GlobalContext);\n  const { edit, setEdit } = useContext(GlobalEdit);\n  const { allClicked, setAllClicked } = useContext(FieldButtons);\n\n  const fieldCount = value.gy.fields.length;\n  const allFields = {\n    id: 100,\n    value: \"ALLE\",\n  };\n  const clickedButtons = Array(fieldCount);\n\n  const handleOnClick = useCallback((id) => {\n    console.log(id);\n    clickedButtons[id] = !clickedButtons[id];\n    console.log(clickedButtons);\n  });\n\n  const currentFields = value.gy.fields.map((item, index) => (\n    <li className=\"field-list-item\">\n      <FieldButton\n        parentClick={() => handleOnClick(index)}\n        index={index}\n        item={item}\n      ></FieldButton>\n    </li>\n  ));\n\n  const allFieldsButton = (\n    <AllFieldsButton name={allFields.value}></AllFieldsButton>\n  );\n\n  currentFields.push(allFieldsButton);\n  const refArray = Array(30);\n  let currentRef = 0;\n\n  const handleRightClick = () => {\n    if (currentRef > 0 && refArray[currentRef - 1] !== null) {\n      refArray[currentRef - 1].current.scrollIntoView({\n        behavior: \"smooth\",\n        block: \"start\",\n      });\n      currentRef--;\n      console.log(currentRef);\n    }\n  };\n\n  const handleLeftClick = () => {\n    if (currentRef < 28 && refArray[currentRef + 1] !== null) {\n      refArray[currentRef + 1].current.scrollIntoView({\n        behavior: \"smooth\",\n        block: \"start\",\n      });\n      currentRef++;\n      console.log(currentRef);\n    }\n  };\n\n  const dateArray = returnDates().map((date, index) => {\n    const ref = React.createRef();\n    refArray[index] = ref;\n    const key = index;\n\n    return (\n      <li className=\"date-list-item\" ref={ref} dbdate={date.dbValue}>\n        {date.display}\n      </li>\n    );\n  });\n\n  const registerWork = (e) => {\n    e.preventDefault();\n    let updateArray = Array();\n    if (allClicked == 2) {\n      clickedButtons.fill(true);\n    }\n    for (let i = 0; i < value.gy.fields.length; i++) {\n      if (clickedButtons[i] == true) updateArray.push(value.gy.fields[i]);\n    }\n    const completedDate = dateArray[currentRef].props.dbdate;\n    const dbActivity = activity.dbValue;\n    console.log(completedDate);\n    //should do it all in one call\n    if (activity.tag == \"field\") {\n      for (let u in updateArray) {\n        try {\n          const body = { dbActivity, completedDate };\n\n          const response = fetch(\n            `${chosenConnection}/fields/${value.gy.id}/${updateArray[u]}`,\n            {\n              method: \"PUT\",\n              headers: { \"Content-Type\": \"application/json\" },\n              body: JSON.stringify(body),\n            }\n          );\n          console.log(body);\n        } catch (err) {\n          console.log(err.message);\n        }\n      }\n    } else {\n      try {\n        const body = { dbActivity, completedDate };\n\n        const response = fetch(\n          `${chosenConnection}/graveyards/${value.gy.id}`,\n          {\n            method: \"PUT\",\n            headers: { \"Content-Type\": \"application/json\" },\n            body: JSON.stringify(body),\n          }\n        );\n        console.log(body);\n      } catch (err) {\n        console.log(err.message);\n      }\n    }\n    exit();\n  };\n\n  useEffect(() => {}, [dia]);\n\n  if (dia) {\n    return (\n      <div className=\"work-window\">\n        <div className=\"work-window-img-and-fields\">\n          <div className=\"work-window-header\">\n            <p className=\"work-window-text\">\n              Velg felter der det har blitt {activity.value.toLowerCase()}{\" \"}\n            </p>\n            <img src={activity.img} className=\"work-window-img\"></img>\n          </div>\n          <div className=\"work-window-img-holder\">\n            <img src={value.gy.img} className=\"work-window-gy\"></img>\n          </div>\n          <div className=\"work-window-field-container\">\n            <ul className=\"work-window-field-list\">{currentFields}</ul>\n          </div>\n        </div>\n\n        <div className=\"date-selection-box\">\n          <div className=\"date-selection-header\">\n            <h2>Velg utf√∏rt dato</h2>\n          </div>\n          <div className=\"date-finished-container\">\n            <img\n              src={leftArrow}\n              onClick={handleLeftClick}\n              className=\"left-arrow\"\n            ></img>\n\n            <ul className=\"date-list\">{dateArray}</ul>\n            <img\n              src={rightArrow}\n              onClick={handleRightClick}\n              className=\"right-arrow\"\n            ></img>\n          </div>\n        </div>\n        <div className=\"work-window-footer\">\n          <div className=\"work-window-cancel\" onClick={exit}>\n            Avbryt\n          </div>\n          <div className=\"work-window-register\" onClick={registerWork}>\n            Registrer\n          </div>\n        </div>\n      </div>\n    );\n  }\n});\n\nexport default WorkWindow;\n"]},"metadata":{},"sourceType":"module"}